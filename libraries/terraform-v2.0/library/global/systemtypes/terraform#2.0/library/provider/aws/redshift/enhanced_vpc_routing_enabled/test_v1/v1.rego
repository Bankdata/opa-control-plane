package global.systemtypes["terraform:2.0"].library.provider.aws.redshift.enhanced_vpc_routing_enabled.test_v1

import data.global.systemtypes["terraform:2.0"].library.provider.aws.redshift.enhanced_vpc_routing_enabled.v1

test_enhanced_vpc_routing_enabled_redshift_good {
	enabled := true
	in := input_redshift_cluster(enabled)
	actual := v1.prohibit_redshift_cluster_with_enhanced_vpc_routing_disabled with input as in
	count(actual) == 0
}

test_enhanced_vpc_routing_enabled_redshift_bad {
	enabled := false
	in := input_redshift_cluster(enabled)
	actual := v1.prohibit_redshift_cluster_with_enhanced_vpc_routing_disabled with input as in
	count(actual) == 1
}

test_enhanced_vpc_routing_enabled_not_exists_in_redshift_bad {
	in := input_redshift_cluster_without_enhanced_vpc_routing_enabled
	actual := v1.prohibit_redshift_cluster_with_enhanced_vpc_routing_disabled with input as in
	count(actual) == 1
}

input_redshift_cluster(value) = x {
	x := {
		"format_version": "1.1",
		"terraform_version": "1.3.6",
		"variables": {"region": {"value": "us-west-2"}},
		"planned_values": {"root_module": {"resources": [{
			"address": "aws_redshift_cluster.tf_redshift",
			"mode": "managed",
			"type": "aws_redshift_cluster",
			"name": "tf_redshift",
			"provider_name": "registry.terraform.io/hashicorp/aws",
			"schema_version": 0,
			"values": {
				"allow_version_upgrade": true,
				"apply_immediately": false,
				"automated_snapshot_retention_period": 1,
				"availability_zone_relocation_enabled": null,
				"cluster_identifier": "tf-redshift-cluster",
				"cluster_type": "single-node",
				"cluster_version": "1.0",
				"database_name": "mydb",
				"elastic_ip": null,
				"encrypted": false,
				"enhanced_vpc_routing": value,
				"final_snapshot_identifier": null,
				"logging": [],
				"maintenance_track_name": "current",
				"manual_snapshot_retention_period": -1,
				"master_password": "Mustbe8characters",
				"master_username": "exampleuser",
				"node_type": "ra3.xlplus",
				"number_of_nodes": 1,
				"owner_account": null,
				"port": 5439,
				"publicly_accessible": true,
				"skip_final_snapshot": true,
				"snapshot_cluster_identifier": null,
				"snapshot_copy": [],
				"snapshot_identifier": null,
				"tags": null,
				"timeouts": null,
			},
			"sensitive_values": {
				"cluster_nodes": [],
				"cluster_security_groups": [],
				"iam_roles": [],
				"logging": [],
				"snapshot_copy": [],
				"tags_all": {},
				"vpc_security_group_ids": [],
			},
		}]}},
		"resource_changes": [{
			"address": "aws_redshift_cluster.tf_redshift",
			"mode": "managed",
			"type": "aws_redshift_cluster",
			"name": "tf_redshift",
			"provider_name": "registry.terraform.io/hashicorp/aws",
			"change": {
				"actions": ["create"],
				"before": null,
				"after": {
					"allow_version_upgrade": true,
					"apply_immediately": false,
					"automated_snapshot_retention_period": 1,
					"availability_zone_relocation_enabled": null,
					"cluster_identifier": "tf-redshift-cluster",
					"cluster_type": "single-node",
					"cluster_version": "1.0",
					"database_name": "mydb",
					"elastic_ip": null,
					"encrypted": false,
					"enhanced_vpc_routing": value,
					"final_snapshot_identifier": null,
					"logging": [],
					"maintenance_track_name": "current",
					"manual_snapshot_retention_period": -1,
					"master_password": "Mustbe8characters",
					"master_username": "exampleuser",
					"node_type": "ra3.xlplus",
					"number_of_nodes": 1,
					"owner_account": null,
					"port": 5439,
					"publicly_accessible": true,
					"skip_final_snapshot": true,
					"snapshot_cluster_identifier": null,
					"snapshot_copy": [],
					"snapshot_identifier": null,
					"tags": null,
					"timeouts": null,
				},
				"after_unknown": {
					"aqua_configuration_status": true,
					"arn": true,
					"availability_zone": true,
					"cluster_nodes": true,
					"cluster_parameter_group_name": true,
					"cluster_public_key": true,
					"cluster_revision_number": true,
					"cluster_security_groups": true,
					"cluster_subnet_group_name": true,
					"default_iam_role_arn": true,
					"dns_name": true,
					"endpoint": true,
					"iam_roles": true,
					"id": true,
					"kms_key_id": true,
					"logging": [],
					"preferred_maintenance_window": true,
					"snapshot_copy": [],
					"tags_all": true,
					"vpc_security_group_ids": true,
				},
				"before_sensitive": false,
				"after_sensitive": {
					"cluster_nodes": [],
					"cluster_security_groups": [],
					"iam_roles": [],
					"logging": [],
					"master_password": true,
					"snapshot_copy": [],
					"tags_all": {},
					"vpc_security_group_ids": [],
				},
			},
		}],
		"configuration": {
			"provider_config": {"aws": {
				"name": "aws",
				"full_name": "registry.terraform.io/hashicorp/aws",
				"version_constraint": "~> 4.0",
				"expressions": {"region": {"references": ["var.region"]}},
			}},
			"root_module": {
				"resources": [{
					"address": "aws_redshift_cluster.tf_redshift",
					"mode": "managed",
					"type": "aws_redshift_cluster",
					"name": "tf_redshift",
					"provider_config_key": "aws",
					"expressions": {
						"cluster_identifier": {"constant_value": "tf-redshift-cluster"},
						"cluster_type": {"constant_value": "single-node"},
						"database_name": {"constant_value": "mydb"},
						"enhanced_vpc_routing": {"constant_value": true},
						"master_password": {"constant_value": "Mustbe8characters"},
						"master_username": {"constant_value": "exampleuser"},
						"node_type": {"constant_value": "ra3.xlplus"},
						"publicly_accessible": {"constant_value": true},
						"skip_final_snapshot": {"constant_value": true},
					},
					"schema_version": 0,
				}],
				"variables": {"region": {"default": "us-west-2"}},
			},
		},
	}
}

input_redshift_cluster_without_enhanced_vpc_routing_enabled = x {
	x := {
		"format_version": "1.1",
		"terraform_version": "1.3.6",
		"variables": {"region": {"value": "us-west-2"}},
		"planned_values": {"root_module": {"resources": [{
			"address": "aws_redshift_cluster.tf_redshift",
			"mode": "managed",
			"type": "aws_redshift_cluster",
			"name": "tf_redshift",
			"provider_name": "registry.terraform.io/hashicorp/aws",
			"schema_version": 0,
			"values": {
				"allow_version_upgrade": true,
				"apply_immediately": false,
				"automated_snapshot_retention_period": 1,
				"availability_zone_relocation_enabled": null,
				"cluster_identifier": "tf-redshift-cluster",
				"cluster_type": "single-node",
				"cluster_version": "1.0",
				"database_name": "mydb",
				"elastic_ip": null,
				"encrypted": false,
				"final_snapshot_identifier": null,
				"logging": [],
				"maintenance_track_name": "current",
				"manual_snapshot_retention_period": -1,
				"master_password": "Mustbe8characters",
				"master_username": "exampleuser",
				"node_type": "ra3.xlplus",
				"number_of_nodes": 1,
				"owner_account": null,
				"port": 5439,
				"publicly_accessible": true,
				"skip_final_snapshot": true,
				"snapshot_cluster_identifier": null,
				"snapshot_copy": [],
				"snapshot_identifier": null,
				"tags": null,
				"timeouts": null,
			},
			"sensitive_values": {
				"cluster_nodes": [],
				"cluster_security_groups": [],
				"iam_roles": [],
				"logging": [],
				"snapshot_copy": [],
				"tags_all": {},
				"vpc_security_group_ids": [],
			},
		}]}},
		"resource_changes": [{
			"address": "aws_redshift_cluster.tf_redshift",
			"mode": "managed",
			"type": "aws_redshift_cluster",
			"name": "tf_redshift",
			"provider_name": "registry.terraform.io/hashicorp/aws",
			"change": {
				"actions": ["create"],
				"before": null,
				"after": {
					"allow_version_upgrade": true,
					"apply_immediately": false,
					"automated_snapshot_retention_period": 1,
					"availability_zone_relocation_enabled": null,
					"cluster_identifier": "tf-redshift-cluster",
					"cluster_type": "single-node",
					"cluster_version": "1.0",
					"database_name": "mydb",
					"elastic_ip": null,
					"encrypted": false,
					"final_snapshot_identifier": null,
					"logging": [],
					"maintenance_track_name": "current",
					"manual_snapshot_retention_period": -1,
					"master_password": "Mustbe8characters",
					"master_username": "exampleuser",
					"node_type": "ra3.xlplus",
					"number_of_nodes": 1,
					"owner_account": null,
					"port": 5439,
					"publicly_accessible": true,
					"skip_final_snapshot": true,
					"snapshot_cluster_identifier": null,
					"snapshot_copy": [],
					"snapshot_identifier": null,
					"tags": null,
					"timeouts": null,
				},
				"after_unknown": {
					"aqua_configuration_status": true,
					"arn": true,
					"availability_zone": true,
					"cluster_nodes": true,
					"cluster_parameter_group_name": true,
					"cluster_public_key": true,
					"cluster_revision_number": true,
					"cluster_security_groups": true,
					"cluster_subnet_group_name": true,
					"default_iam_role_arn": true,
					"dns_name": true,
					"endpoint": true,
					"iam_roles": true,
					"id": true,
					"kms_key_id": true,
					"logging": [],
					"preferred_maintenance_window": true,
					"snapshot_copy": [],
					"tags_all": true,
					"vpc_security_group_ids": true,
				},
				"before_sensitive": false,
				"after_sensitive": {
					"cluster_nodes": [],
					"cluster_security_groups": [],
					"iam_roles": [],
					"logging": [],
					"master_password": true,
					"snapshot_copy": [],
					"tags_all": {},
					"vpc_security_group_ids": [],
				},
			},
		}],
		"configuration": {
			"provider_config": {"aws": {
				"name": "aws",
				"full_name": "registry.terraform.io/hashicorp/aws",
				"version_constraint": "~> 4.0",
				"expressions": {"region": {"references": ["var.region"]}},
			}},
			"root_module": {
				"resources": [{
					"address": "aws_redshift_cluster.tf_redshift",
					"mode": "managed",
					"type": "aws_redshift_cluster",
					"name": "tf_redshift",
					"provider_config_key": "aws",
					"expressions": {
						"cluster_identifier": {"constant_value": "tf-redshift-cluster"},
						"cluster_type": {"constant_value": "single-node"},
						"database_name": {"constant_value": "mydb"},
						"enhanced_vpc_routing": {"constant_value": true},
						"master_password": {"constant_value": "Mustbe8characters"},
						"master_username": {"constant_value": "exampleuser"},
						"node_type": {"constant_value": "ra3.xlplus"},
						"publicly_accessible": {"constant_value": true},
						"skip_final_snapshot": {"constant_value": true},
					},
					"schema_version": 0,
				}],
				"variables": {"region": {"default": "us-west-2"}},
			},
		},
	}
}
