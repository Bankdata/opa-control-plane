package global.systemtypes["terraform:2.0"].library.provider.aws.ecs.service_with_no_public_ip.test_v1

import data.global.systemtypes["terraform:2.0"].library.provider.aws.ecs.service_with_no_public_ip.v1

test_ecs_service_assign_public_ip_good {
	assign_public_ip := false
	in := input_ecs_service(assign_public_ip)
	actual := v1.prohibit_ecs_service_with_public_ip_set_as_true with input as in

	count(actual) == 0
}

test_ecs_service_assign_public_ip_bad {
	assign_public_ip := true
	in := input_ecs_service(assign_public_ip)
	actual := v1.prohibit_ecs_service_with_public_ip_set_as_true with input as in

	count(actual) == 1
}

input_ecs_service(assign_public_ip) = x {
	x := {
		"format_version": "1.1",
		"terraform_version": "1.2.7",
		"planned_values": {"root_module": {"child_modules": [{
			"resources": [
				{
					"address": "module.sample_ecs_service.aws_ecs_service.mongo",
					"mode": "managed",
					"type": "aws_ecs_service",
					"name": "mongo",
					"provider_name": "registry.terraform.io/hashicorp/aws",
					"schema_version": 0,
					"values": {
						"capacity_provider_strategy": [],
						"deployment_circuit_breaker": [],
						"deployment_controller": [],
						"deployment_maximum_percent": 200,
						"deployment_minimum_healthy_percent": 100,
						"desired_count": null,
						"enable_ecs_managed_tags": false,
						"enable_execute_command": false,
						"force_new_deployment": null,
						"health_check_grace_period_seconds": null,
						"load_balancer": [],
						"name": "mongodb",
						"network_configuration": [{
							"assign_public_ip": assign_public_ip,
							"security_groups": null,
						}],
						"ordered_placement_strategy": [{
							"field": "cpu",
							"type": "binpack",
						}],
						"placement_constraints": [{
							"expression": "attribute:ecs.availability-zone in [us-west-2a, us-west-2b]",
							"type": "memberOf",
						}],
						"propagate_tags": null,
						"scheduling_strategy": "REPLICA",
						"service_connect_configuration": [],
						"service_registries": [],
						"tags": null,
						"task_definition": null,
						"timeouts": null,
						"wait_for_steady_state": false,
					},
					"sensitive_values": {
						"capacity_provider_strategy": [],
						"deployment_circuit_breaker": [],
						"deployment_controller": [],
						"load_balancer": [],
						"network_configuration": [{"subnets": []}],
						"ordered_placement_strategy": [{}],
						"placement_constraints": [{}],
						"service_connect_configuration": [],
						"service_registries": [],
						"tags_all": {},
						"triggers": {},
					},
				},
				{
					"address": "module.sample_ecs_service.aws_iam_role.test_role",
					"mode": "managed",
					"type": "aws_iam_role",
					"name": "test_role",
					"provider_name": "registry.terraform.io/hashicorp/aws",
					"schema_version": 0,
					"values": {
						"assume_role_policy": "{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"ec2.amazonaws.com\"},\"Sid\":\"\"}],\"Version\":\"2012-10-17\"}",
						"description": null,
						"force_detach_policies": false,
						"max_session_duration": 3600,
						"name": "test_role",
						"path": "/",
						"permissions_boundary": null,
						"tags": {"Name": "Sample-IAM-Role"},
						"tags_all": {"Name": "Sample-IAM-Role"},
					},
					"sensitive_values": {
						"inline_policy": [],
						"managed_policy_arns": [],
						"tags": {},
						"tags_all": {},
					},
				},
				{
					"address": "module.sample_ecs_service.aws_internet_gateway.igw",
					"mode": "managed",
					"type": "aws_internet_gateway",
					"name": "igw",
					"provider_name": "registry.terraform.io/hashicorp/aws",
					"schema_version": 0,
					"values": {
						"tags": {"Name": "vpc_igw"},
						"tags_all": {"Name": "vpc_igw"},
						"timeouts": null,
					},
					"sensitive_values": {
						"tags": {},
						"tags_all": {},
					},
				},
				{
					"address": "module.sample_ecs_service.aws_route_table.vpc_rt",
					"mode": "managed",
					"type": "aws_route_table",
					"name": "vpc_rt",
					"provider_name": "registry.terraform.io/hashicorp/aws",
					"schema_version": 0,
					"values": {
						"route": [{
							"carrier_gateway_id": "",
							"cidr_block": "0.0.0.0/0",
							"core_network_arn": "",
							"destination_prefix_list_id": "",
							"egress_only_gateway_id": "",
							"instance_id": "",
							"ipv6_cidr_block": "",
							"local_gateway_id": "",
							"nat_gateway_id": "",
							"network_interface_id": "",
							"transit_gateway_id": "",
							"vpc_endpoint_id": "",
							"vpc_peering_connection_id": "",
						}],
						"tags": {"Name": "vpc_rt"},
						"tags_all": {"Name": "vpc_rt"},
						"timeouts": null,
					},
					"sensitive_values": {
						"propagating_vgws": [],
						"route": [{}],
						"tags": {},
						"tags_all": {},
					},
				},
				{
					"address": "module.sample_ecs_service.aws_subnet.subnet",
					"mode": "managed",
					"type": "aws_subnet",
					"name": "subnet",
					"provider_name": "registry.terraform.io/hashicorp/aws",
					"schema_version": 1,
					"values": {
						"assign_ipv6_address_on_creation": false,
						"availability_zone": "us-west-2a",
						"cidr_block": "178.0.10.0/24",
						"customer_owned_ipv4_pool": null,
						"enable_dns64": false,
						"enable_resource_name_dns_a_record_on_launch": false,
						"enable_resource_name_dns_aaaa_record_on_launch": false,
						"ipv6_cidr_block": null,
						"ipv6_native": false,
						"map_customer_owned_ip_on_launch": null,
						"map_public_ip_on_launch": false,
						"outpost_arn": null,
						"tags": {"Name": "vpc-subnet"},
						"tags_all": {"Name": "vpc-subnet"},
						"timeouts": null,
					},
					"sensitive_values": {
						"tags": {},
						"tags_all": {},
					},
				},
				{
					"address": "module.sample_ecs_service.aws_vpc.main",
					"mode": "managed",
					"type": "aws_vpc",
					"name": "main",
					"provider_name": "registry.terraform.io/hashicorp/aws",
					"schema_version": 1,
					"values": {
						"assign_generated_ipv6_cidr_block": null,
						"cidr_block": "178.0.0.0/16",
						"enable_dns_support": true,
						"instance_tenancy": "default",
						"ipv4_ipam_pool_id": null,
						"ipv4_netmask_length": null,
						"ipv6_ipam_pool_id": null,
						"ipv6_netmask_length": null,
						"tags": {"Name": "app-vpc"},
						"tags_all": {"Name": "app-vpc"},
					},
					"sensitive_values": {
						"tags": {},
						"tags_all": {},
					},
				},
			],
			"address": "module.sample_ecs_service",
		}]}},
		"resource_changes": [
			{
				"address": "module.sample_ecs_service.aws_ecs_service.mongo",
				"module_address": "module.sample_ecs_service",
				"mode": "managed",
				"type": "aws_ecs_service",
				"name": "mongo",
				"provider_name": "registry.terraform.io/hashicorp/aws",
				"change": {
					"actions": ["create"],
					"before": null,
					"after": {
						"capacity_provider_strategy": [],
						"deployment_circuit_breaker": [],
						"deployment_controller": [],
						"deployment_maximum_percent": 200,
						"deployment_minimum_healthy_percent": 100,
						"desired_count": null,
						"enable_ecs_managed_tags": false,
						"enable_execute_command": false,
						"force_new_deployment": null,
						"health_check_grace_period_seconds": null,
						"load_balancer": [],
						"name": "mongodb",
						"network_configuration": [{
							"assign_public_ip": assign_public_ip,
							"security_groups": null,
						}],
						"ordered_placement_strategy": [{
							"field": "cpu",
							"type": "binpack",
						}],
						"placement_constraints": [{
							"expression": "attribute:ecs.availability-zone in [us-west-2a, us-west-2b]",
							"type": "memberOf",
						}],
						"propagate_tags": null,
						"scheduling_strategy": "REPLICA",
						"service_connect_configuration": [],
						"service_registries": [],
						"tags": null,
						"task_definition": null,
						"timeouts": null,
						"wait_for_steady_state": false,
					},
					"after_unknown": {
						"capacity_provider_strategy": [],
						"cluster": true,
						"deployment_circuit_breaker": [],
						"deployment_controller": [],
						"iam_role": true,
						"id": true,
						"launch_type": true,
						"load_balancer": [],
						"network_configuration": [{"subnets": true}],
						"ordered_placement_strategy": [{}],
						"placement_constraints": [{}],
						"platform_version": true,
						"service_connect_configuration": [],
						"service_registries": [],
						"tags_all": true,
						"triggers": true,
					},
					"before_sensitive": false,
					"after_sensitive": {
						"capacity_provider_strategy": [],
						"deployment_circuit_breaker": [],
						"deployment_controller": [],
						"load_balancer": [],
						"network_configuration": [{"subnets": []}],
						"ordered_placement_strategy": [{}],
						"placement_constraints": [{}],
						"service_connect_configuration": [],
						"service_registries": [],
						"tags_all": {},
						"triggers": {},
					},
				},
			},
			{
				"address": "module.sample_ecs_service.aws_iam_role.test_role",
				"module_address": "module.sample_ecs_service",
				"mode": "managed",
				"type": "aws_iam_role",
				"name": "test_role",
				"provider_name": "registry.terraform.io/hashicorp/aws",
				"change": {
					"actions": ["create"],
					"before": null,
					"after": {
						"assume_role_policy": "{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"ec2.amazonaws.com\"},\"Sid\":\"\"}],\"Version\":\"2012-10-17\"}",
						"description": null,
						"force_detach_policies": false,
						"max_session_duration": 3600,
						"name": "test_role",
						"path": "/",
						"permissions_boundary": null,
						"tags": {"Name": "Sample-IAM-Role"},
						"tags_all": {"Name": "Sample-IAM-Role"},
					},
					"after_unknown": {
						"arn": true,
						"create_date": true,
						"id": true,
						"inline_policy": true,
						"managed_policy_arns": true,
						"name_prefix": true,
						"tags": {},
						"tags_all": {},
						"unique_id": true,
					},
					"before_sensitive": false,
					"after_sensitive": {
						"inline_policy": [],
						"managed_policy_arns": [],
						"tags": {},
						"tags_all": {},
					},
				},
			},
			{
				"address": "module.sample_ecs_service.aws_internet_gateway.igw",
				"module_address": "module.sample_ecs_service",
				"mode": "managed",
				"type": "aws_internet_gateway",
				"name": "igw",
				"provider_name": "registry.terraform.io/hashicorp/aws",
				"change": {
					"actions": ["create"],
					"before": null,
					"after": {
						"tags": {"Name": "vpc_igw"},
						"tags_all": {"Name": "vpc_igw"},
						"timeouts": null,
					},
					"after_unknown": {
						"arn": true,
						"id": true,
						"owner_id": true,
						"tags": {},
						"tags_all": {},
						"vpc_id": true,
					},
					"before_sensitive": false,
					"after_sensitive": {
						"tags": {},
						"tags_all": {},
					},
				},
			},
			{
				"address": "module.sample_ecs_service.aws_route_table.vpc_rt",
				"module_address": "module.sample_ecs_service",
				"mode": "managed",
				"type": "aws_route_table",
				"name": "vpc_rt",
				"provider_name": "registry.terraform.io/hashicorp/aws",
				"change": {
					"actions": ["create"],
					"before": null,
					"after": {
						"route": [{
							"carrier_gateway_id": "",
							"cidr_block": "0.0.0.0/0",
							"core_network_arn": "",
							"destination_prefix_list_id": "",
							"egress_only_gateway_id": "",
							"instance_id": "",
							"ipv6_cidr_block": "",
							"local_gateway_id": "",
							"nat_gateway_id": "",
							"network_interface_id": "",
							"transit_gateway_id": "",
							"vpc_endpoint_id": "",
							"vpc_peering_connection_id": "",
						}],
						"tags": {"Name": "vpc_rt"},
						"tags_all": {"Name": "vpc_rt"},
						"timeouts": null,
					},
					"after_unknown": {
						"arn": true,
						"id": true,
						"owner_id": true,
						"propagating_vgws": true,
						"route": [{"gateway_id": true}],
						"tags": {},
						"tags_all": {},
						"vpc_id": true,
					},
					"before_sensitive": false,
					"after_sensitive": {
						"propagating_vgws": [],
						"route": [{}],
						"tags": {},
						"tags_all": {},
					},
				},
			},
			{
				"address": "module.sample_ecs_service.aws_subnet.subnet",
				"module_address": "module.sample_ecs_service",
				"mode": "managed",
				"type": "aws_subnet",
				"name": "subnet",
				"provider_name": "registry.terraform.io/hashicorp/aws",
				"change": {
					"actions": ["create"],
					"before": null,
					"after": {
						"assign_ipv6_address_on_creation": false,
						"availability_zone": "us-west-2a",
						"cidr_block": "178.0.10.0/24",
						"customer_owned_ipv4_pool": null,
						"enable_dns64": false,
						"enable_resource_name_dns_a_record_on_launch": false,
						"enable_resource_name_dns_aaaa_record_on_launch": false,
						"ipv6_cidr_block": null,
						"ipv6_native": false,
						"map_customer_owned_ip_on_launch": null,
						"map_public_ip_on_launch": false,
						"outpost_arn": null,
						"tags": {"Name": "vpc-subnet"},
						"tags_all": {"Name": "vpc-subnet"},
						"timeouts": null,
					},
					"after_unknown": {
						"arn": true,
						"availability_zone_id": true,
						"id": true,
						"ipv6_cidr_block_association_id": true,
						"owner_id": true,
						"private_dns_hostname_type_on_launch": true,
						"tags": {},
						"tags_all": {},
						"vpc_id": true,
					},
					"before_sensitive": false,
					"after_sensitive": {
						"tags": {},
						"tags_all": {},
					},
				},
			},
			{
				"address": "module.sample_ecs_service.aws_vpc.main",
				"module_address": "module.sample_ecs_service",
				"mode": "managed",
				"type": "aws_vpc",
				"name": "main",
				"provider_name": "registry.terraform.io/hashicorp/aws",
				"change": {
					"actions": ["create"],
					"before": null,
					"after": {
						"assign_generated_ipv6_cidr_block": null,
						"cidr_block": "178.0.0.0/16",
						"enable_dns_support": true,
						"instance_tenancy": "default",
						"ipv4_ipam_pool_id": null,
						"ipv4_netmask_length": null,
						"ipv6_ipam_pool_id": null,
						"ipv6_netmask_length": null,
						"tags": {"Name": "app-vpc"},
						"tags_all": {"Name": "app-vpc"},
					},
					"after_unknown": {
						"arn": true,
						"default_network_acl_id": true,
						"default_route_table_id": true,
						"default_security_group_id": true,
						"dhcp_options_id": true,
						"enable_classiclink": true,
						"enable_classiclink_dns_support": true,
						"enable_dns_hostnames": true,
						"enable_network_address_usage_metrics": true,
						"id": true,
						"ipv6_association_id": true,
						"ipv6_cidr_block": true,
						"ipv6_cidr_block_network_border_group": true,
						"main_route_table_id": true,
						"owner_id": true,
						"tags": {},
						"tags_all": {},
					},
					"before_sensitive": false,
					"after_sensitive": {
						"tags": {},
						"tags_all": {},
					},
				},
			},
		],
		"configuration": {
			"provider_config": {"module.sample_ecs_service:aws": {
				"name": "aws",
				"full_name": "registry.terraform.io/hashicorp/aws",
				"version_constraint": "~> 4.0",
				"module_address": "module.sample_ecs_service",
				"expressions": {"region": {"references": ["var.aws_region"]}},
			}},
			"root_module": {"module_calls": {"sample_ecs_service": {
				"source": "../../../../../modules/ecs/service",
				"module": {
					"resources": [
						{
							"address": "aws_ecs_service.mongo",
							"mode": "managed",
							"type": "aws_ecs_service",
							"name": "mongo",
							"provider_config_key": "module.sample_ecs_service:aws",
							"expressions": {
								"iam_role": {"references": [
									"aws_iam_role.test_role.arn",
									"aws_iam_role.test_role",
								]},
								"name": {"constant_value": "mongodb"},
								"network_configuration": [{
									"assign_public_ip": {"constant_value": false},
									"subnets": {"references": [
										"aws_subnet.subnet.id",
										"aws_subnet.subnet",
									]},
								}],
								"ordered_placement_strategy": [{
									"field": {"constant_value": "cpu"},
									"type": {"constant_value": "binpack"},
								}],
								"placement_constraints": [{
									"expression": {"constant_value": "attribute:ecs.availability-zone in [us-west-2a, us-west-2b]"},
									"type": {"constant_value": "memberOf"},
								}],
							},
							"schema_version": 0,
						},
						{
							"address": "aws_iam_role.test_role",
							"mode": "managed",
							"type": "aws_iam_role",
							"name": "test_role",
							"provider_config_key": "module.sample_ecs_service:aws",
							"expressions": {
								"assume_role_policy": {},
								"name": {"constant_value": "test_role"},
								"tags": {"constant_value": {"Name": "Sample-IAM-Role"}},
							},
							"schema_version": 0,
						},
						{
							"address": "aws_internet_gateway.igw",
							"mode": "managed",
							"type": "aws_internet_gateway",
							"name": "igw",
							"provider_config_key": "module.sample_ecs_service:aws",
							"expressions": {
								"tags": {"constant_value": {"Name": "vpc_igw"}},
								"vpc_id": {"references": [
									"aws_vpc.main.id",
									"aws_vpc.main",
								]},
							},
							"schema_version": 0,
						},
						{
							"address": "aws_route_table.vpc_rt",
							"mode": "managed",
							"type": "aws_route_table",
							"name": "vpc_rt",
							"provider_config_key": "module.sample_ecs_service:aws",
							"expressions": {
								"route": {"references": [
									"aws_internet_gateway.igw.id",
									"aws_internet_gateway.igw",
								]},
								"tags": {"constant_value": {"Name": "vpc_rt"}},
								"vpc_id": {"references": [
									"aws_vpc.main.id",
									"aws_vpc.main",
								]},
							},
							"schema_version": 0,
						},
						{
							"address": "aws_subnet.subnet",
							"mode": "managed",
							"type": "aws_subnet",
							"name": "subnet",
							"provider_config_key": "module.sample_ecs_service:aws",
							"expressions": {
								"availability_zone": {"constant_value": "us-west-2a"},
								"cidr_block": {"references": ["var.subnet_cidr"]},
								"tags": {"constant_value": {"Name": "vpc-subnet"}},
								"vpc_id": {"references": [
									"aws_vpc.main.id",
									"aws_vpc.main",
								]},
							},
							"schema_version": 1,
						},
						{
							"address": "aws_vpc.main",
							"mode": "managed",
							"type": "aws_vpc",
							"name": "main",
							"provider_config_key": "module.sample_ecs_service:aws",
							"expressions": {
								"cidr_block": {"references": ["var.vpc_cidr"]},
								"tags": {"constant_value": {"Name": "app-vpc"}},
							},
							"schema_version": 1,
						},
					],
					"variables": {
						"aws_region": {"default": "us-west-2"},
						"subnet_cidr": {"default": "178.0.10.0/24"},
						"vpc_cidr": {"default": "178.0.0.0/16"},
					},
				},
			}}},
		},
		"relevant_attributes": [
			{
				"resource": "module.sample_ecs_service.aws_vpc.main",
				"attribute": ["id"],
			},
			{
				"resource": "module.sample_ecs_service.aws_internet_gateway.igw",
				"attribute": ["id"],
			},
			{
				"resource": "module.sample_ecs_service.aws_iam_role.test_role",
				"attribute": ["arn"],
			},
			{
				"resource": "module.sample_ecs_service.aws_subnet.subnet",
				"attribute": ["id"],
			},
		],
	}
}
